<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vier gewinnt</title>
  <style>
    div {
      box-sizing: border-box;
    }
    .board {
      width: 84vw;
      margin: auto;
      outline: 1px solid black;
      display: grid;
      grid-template-columns: repeat(7, 12vw);
      grid-auto-rows: 12vw;
      gap: 0;
    }
    .board .field {
      border: 1px solid black;
      width: 12vw;
      height: 12vw;
    }
    .board .field .piece {
      width: 10vw;
      height: 10vw;
      border-radius: 50%;
      margin: 1vw;
    }
    .board .field .blue {
      background-color: blue;
    }
    .board .field .red {
      background-color: red;
    }
  </style>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    // Hilfsfunktionen f√ºr das Spielfeld
    const createInitialState = () => ({
    board: Array(6).fill(null).map(() => Array(7).fill("")),
    current: "r",
    winner: null
    });

    function App() {
    const [gameState, setGameState] = React.useState(createInitialState());
    const [stateSeq, setStateSeq] = React.useState([]);

    const handleFieldClick = (col) => {
        if (gameState.winner) return;
        const row = findEmptyRow(gameState.board, col);

        if (row !== -1) {
            // 1. Historie sichern (unver√§nderlich)
            setStateSeq([...stateSeq, gameState]);

            // 2. Neues Board berechnen
            const updatedRow = setInList(gameState.board[row], col, gameState.current);
            const updatedBoard = setInList(gameState.board, row, updatedRow);

            let nextState = setInObj(gameState, "board", updatedBoard);

            // 3. Sieg oder Spielerwechsel
            if (connect4Winner(gameState.current, updatedBoard)) {
                nextState = setInObj(nextState, "winner", gameState.current);
            } else {
                const nextPlayer = gameState.current === 'r' ? 'b' : 'r';
                nextState = setInObj(nextState, "current", nextPlayer);
            }
            
            setGameState(nextState); // Hier war der kleine Namensdreher
        }
    };

    const handleUndo = () => {
        if (stateSeq.length > 0) {
            setGameState(stateSeq.at(-1));
            const lastStates = stateSeq.slice(0, -1);
            setStateSeq(lastStates); // Neue Liste ohne das letzte Element
        }
    };

    const reset = () => {
        setGameState(createInitialState());
        setStateSeq([]); // So leeren wir den State in React richtig
    };

    return (
        <div className="app-container">
        <h1>Vier gewinnt</h1>
        <Status current={gameState.current} winner={gameState.winner} />
        <Board board={gameState.board} onFieldClick={handleFieldClick} />
        <div className="controls">
            <button onClick={handleUndo} className="undo">Undo</button>
            <button onClick={reset}>Reset</button>
        </div>
        </div>
    );
    }

    // --- Unterkomponenten ---

    const Board = ({ board, onFieldClick }) => (
    <div className="board">
        {board.map((row, r) =>
        row.map((cell, c) => (
            <Field key={`${r}-${c}`} type={cell} onClick={() => onFieldClick(c)} />
        ))
        )}
    </div>
    );

    const Field = ({ type, onClick }) => (
    <div className="field" onClick={onClick}>
        {type && <div className={`piece ${type === 'r' ? 'red' : 'blue'}`} />}
    </div>
    );

    const Status = ({ current, winner }) => (
    winner ? <h2>{winner === 'r' ? 'Rot' : 'Blau'} hat gewonnen! üèÜ</h2>
            : <h2>{current === 'r' ? 'Rot' : 'Blau'} ist am Zug</h2>
    );

    // --- Hilfsfunktionen am Ende ---
    function setInList(lst, idx, val) {
        const newList = [...lst];
        newList[idx] = val;
        return newList;
    }

    function setInObj(obj, attr, val) {
        return { ...obj, [attr]: val };
    }

    function findEmptyRow(board, col) {
        for (let row = 5; row >= 0; row--) {
            if (board[row][col] === "") return row;
        }
        return -1;
    }

    function connect4Winner(player, board) {
    // 1. √úberpr√ºfung horizontal
    for (let row = 0; row <= 5; row++) { 
        for (let col = 0; col <= 3; col++) { 
            if (board[row][col] === player && 
                board[row][col+1] === player && 
                board[row][col+2] === player && 
                board[row][col+3] === player) { 
                    return true; 
                }
            }
        };
    // 2. √úberpr√ºfung vertikal
    for (let row = 0; row <= 2; row++) { 
        for (let col = 0; col <= 6; col++) { 
            if (board[row][col] === player && 
                board[row+1][col] === player && 
                board[row+2][col] === player && 
                board[row+3][col] === player) { 
                    return true; 
                }
            }
        };
    // 3. Diagonal absteigend:¬†
    for (let row = 0; row <= 2; row++) {
        for (let col = 0; col <= 3; col++) {
            if (board[row][col] === player &&
                board[row+1][col+1] === player &&
                board[row+2][col+2] === player &&
                board[row+3][col+3] === player) {
                    return true;
                }
            }
        };

    // 4. Diagonal aufsteigend:
    for (let row = 5; row >= 3; row--) {
        for (let col = 0; col <= 3; col++) {
            if (board[row][col] === player &&
                board[row-1][col+1] === player &&
                board[row-2][col+2] === player &&
                board[row-3][col+3] === player) {
                    return true;
                }
            }
        };
    return false;
}

    // Rendern
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
